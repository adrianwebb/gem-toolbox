#!/bin/bash

# Test Gem
gem.test || exit "$?"

# Install new version
bundle exec rake version:bump:$1 || exit 10
sudo bundle exec rake install || exit 11

version=`cat VERSION`
releases=(${version//\./ })
branch="${releases[0]}.${releases[1]}"
tag="v${version}"

git tag "$tag"
git push --tags origin "$branch"

rm *.gem 2>/dev/null
gem build *.gemspec || exit 12

# Publish Gem version
gem push *.gem || exit 13
exit 0
